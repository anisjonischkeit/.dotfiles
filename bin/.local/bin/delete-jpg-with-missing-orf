#!/bin/bash

# Check sudo requirement
if [ "$(id -u)" -ne 0 ]; then
  echo "Error: This script must be run with sudo." >&2
  exit 1
fi

# Check for required argument: the target directory
if [ $# -ne 1 ]; then
  echo "Usage: $0 <directory>" >&2
  exit 1
fi

dir="$1"

# Validate directory exists and is a directory
if [ ! -d "$dir" ]; then
  echo "Error: Directory '$dir' does not exist or is not a directory." >&2
  exit 1
fi

# Change to the target directory for consistent path resolution (optional but recommended)
cd "$dir" || exit

# Find all JPG files in the directory (not subdirectories)
find . -maxdepth 1 -type f -name "*.JPG" | while read -r jpg_file; do
  base="${jpg_file%.JPG}"

  # Check if corresponding JPG file exists (case-sensitive match)
  if [ ! -f "$base.ORF" ]; then
    echo "Deleting $jpg_file because $base.ORF does not exist."
    rm -v "$jpg_file" "${base}.ORF.pp3" || true
  fi
done

echo "Done scanning and cleaning up JPG files."
